#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use App\Application;
use React\EventLoop\Factory;
use React\Http\Server as HttpServer;
use React\Socket\Server as SocketServer;

$loop = Factory::create();

$app = new Application($loop);
$config = $app->getConfig();

$socket = new SocketServer($loop);
$http = new HttpServer($socket, $loop);

$http->on('request', [$app, 'onRequest']);
echo "Server running at http://" . $config->host . ":" . $config->port . "" . PHP_EOL;

$socket->listen($config->port, $config->host);

$loop->run();
